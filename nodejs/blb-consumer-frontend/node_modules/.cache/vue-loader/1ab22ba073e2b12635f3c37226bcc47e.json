{"remainingRequest":"D:\\project\\blb-consumer-frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\project\\blb-consumer-frontend\\src\\components\\my\\UserEditPane.vue?vue&type=style&index=0&id=14c13343&lang=less&scoped=true&","dependencies":[{"path":"D:\\project\\blb-consumer-frontend\\src\\components\\my\\UserEditPane.vue","mtime":1606571741830},{"path":"D:\\project\\blb-consumer-frontend\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\project\\blb-consumer-frontend\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\project\\blb-consumer-frontend\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\project\\blb-consumer-frontend\\node_modules\\less-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\project\\blb-consumer-frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\project\\blb-consumer-frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgouYW1hcC1ib3ggewogIHdpZHRoOiAxMDAlOwogIGhlaWdodDogMjAwcHg7Cn0KLmRlbGl2ZXJ5LWxpc3QgewogIC5lbC1pY29uLWVkaXQgewogICAgZm9udC1zaXplOiAyMHB4OwogICAgaGVpZ2h0OiAyOHB4OwogICAgbGluZS1oZWlnaHQ6IDI4cHg7CiAgfQogIGg0IHsKICAgIG1hcmdpbjogMDsKICB9Cn0K"},{"version":3,"sources":["UserEditPane.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"UserEditPane.vue","sourceRoot":"src/components/my","sourcesContent":["<template>\r\n  <el-dialog\r\n    title=\"编辑资料\"\r\n    :visible=\"$store.state.userEditPanelShow\"\r\n    width=\"50%\"\r\n    @close=\"$store.commit('toggleUserEditPanel')\"\r\n    >\r\n    <el-tabs v-model=\"currentTab\">\r\n      <el-tab-pane label=\"收货地址\" name=\"delivery\">\r\n        <ul class=\"delivery-list\">\r\n          <li v-for=\"item in deliveryList\" :key=\"item.deliveryId\" class=\"delivery-item\">\r\n            <el-row>\r\n              <el-col :span=\"16\">\r\n                <h4>{{item.building}} {{item.detail}} <el-tag  v-if=\"item.defaultDelivery\" effect=\"dark\" size=\"medium\">默认地址</el-tag></h4>\r\n              </el-col>\r\n              <el-col :span=\"8\">\r\n                <el-button class=\"default-btn\" type=\"primary\" size=\"mini\"\r\n                style=\"floar:right\"\r\n                v-if=\"!item.defaultDelivery\"\r\n                @click=\"updateDelivery(item)\"\r\n                >设为默认地址</el-button>\r\n                <el-button type=\"danger\" size=\"mini\" @click=\"handleDelteDelivery(item.deliveryId)\">删除</el-button>\r\n              </el-col>\r\n            </el-row>\r\n            <el-divider></el-divider>\r\n          </li>\r\n        </ul>\r\n        <div class=\"new-delivery\">\r\n          <el-form :model=\"deliveryForm\" :rules=\"deliveryFormRules\" ref=\"deliveryForm\" label-width=\"80px\">\r\n            <el-form-item label=\"地址\" prop=\"building\">\r\n              <el-input v-model=\"deliveryForm.building\" placeholder=\"在地图上点击以选择地点\" readonly></el-input>\r\n              <el-amap class=\"amap-box\"\r\n              :vid=\"'amap-vue'\"\r\n              :zoom=\"10\"\r\n              :events=\"mapEvents\"\r\n              :plugin=\"plugin\"\r\n              >\r\n                <!-- <el-amap-marker vid=\"component-marker\" :position=\"[117.5,24]\"></el-amap-marker> -->\r\n              </el-amap>\r\n            </el-form-item>\r\n            <el-form-item label=\"详细地址\" prop=\"detail\">\r\n              <el-input v-model=\"deliveryForm.detail\" placeholder=\"详细地址\"></el-input>\r\n            </el-form-item>\r\n            <el-checkbox v-model=\"deliveryForm.defaultDelivery\">设为默认收货地址</el-checkbox>\r\n            <el-button type=\"success\" size=\"small\" style=\"float:right\" @click=\"handleSaveDelivery\">保存</el-button>\r\n          </el-form>\r\n        </div>\r\n      </el-tab-pane>\r\n      <el-tab-pane label=\"登录密码\" name=\"password\">\r\n        <el-form label-width=\"100px\">\r\n            <el-form-item label=\"旧密码\" prop=\"name\">\r\n              <el-input v-model=\"oldPassword\" placeholder=\"旧密码\" show-password clearable></el-input>\r\n            </el-form-item>\r\n            <el-form-item label=\"新密码\" prop=\"name\">\r\n              <el-input v-model=\"newPassword\" placeholder=\"新密码\" show-password clearable></el-input>\r\n            </el-form-item>\r\n            <el-form-item label=\"重复新密码\" prop=\"name\">\r\n              <el-input v-model=\"repeatPassword\" placeholder=\"重复新密码\" show-password clearable></el-input>\r\n            </el-form-item>\r\n            <el-button type=\"success\" size=\"small\" style=\"float:right\" @click=\"handleUpdatePassword\">确认修改</el-button>\r\n        </el-form>\r\n      </el-tab-pane>\r\n      <el-tab-pane label=\"个人信息\" name=\"info\">\r\n        <el-form label-width=\"70px\">\r\n            <el-form-item label=\"联系人\" prop=\"name\">\r\n              <el-input v-model=\"userInfo.realName\" placeholder=\"姓名\"></el-input>\r\n            </el-form-item>\r\n            <el-form-item label=\"电话\" prop=\"name\">\r\n              <el-input v-model=\"userInfo.phone\" placeholder=\"手机号码\"></el-input>\r\n            </el-form-item>\r\n          </el-form>\r\n        <el-button type=\"success\" size=\"small\" style=\"float:right;margin-top:20px\" @click=\"updateUserInfo\">确认修改</el-button>\r\n      </el-tab-pane>\r\n    </el-tabs>\r\n  </el-dialog>\r\n</template>\r\n\r\n<script>\r\nimport deliveryService from '../../service/DeliveryService'\r\nimport consumerService from '../../service/ConsumerService'\r\nexport default {\r\n  props: ['currentTab'],\r\n  data () {\r\n    return {\r\n      activeName: 'delivery',\r\n      deliveryForm: {\r\n        building: '',\r\n        detail: '',\r\n        defaultDelivery: false\r\n      },\r\n      userInfo: this.$store.state.user.info,\r\n      deliveryFormRules: {\r\n        building: [\r\n          { required: true, message: '请选择地点', trigger: 'blur' }\r\n        ],\r\n        detail: [\r\n          { required: true, message: '情输入详细地址', trigger: 'blur' }\r\n        ]\r\n      },\r\n      oldPassword: '',\r\n      newPassword: '',\r\n      repeatPassword: '',\r\n      deliveryList: [],\r\n      mapEvents: {\r\n        click (e) {\r\n          const { lng, lat } = e.lnglat\r\n          this.lng = lng\r\n          this.lat = lat\r\n\r\n          // 这里通过高德 SDK 完成。\r\n          const geocoder = new AMap.Geocoder({\r\n            radius: 1000,\r\n            extensions: 'all'\r\n          })\r\n          geocoder.getAddress([lng, lat], (status, result) => {\r\n            if (status === 'complete' && result.info === 'OK') {\r\n              if (result && result.regeocode) {\r\n                deliveryService.editPanel.deliveryForm.building = result.regeocode.formattedAddress\r\n              }\r\n            }\r\n          })\r\n        }\r\n      },\r\n      plugin: [{\r\n        pName: 'Geolocation',\r\n        events: {\r\n          init (o) {\r\n            // o 是高德地图定位插件实例\r\n            o.getCurrentPosition((status, result) => {\r\n              if (result && result.position) {\r\n                self.lng = result.position.lng\r\n                self.lat = result.position.lat\r\n                self.center = [self.lng, self.lat]\r\n                self.loaded = true\r\n                self.$nextTick()\r\n              }\r\n            })\r\n          }\r\n        }\r\n      }]\r\n    }\r\n  },\r\n  methods: {\r\n    async getDeliveryList () {\r\n      try {\r\n        this.deliveryList = await deliveryService.getDeliveryList()\r\n      } catch (e) {\r\n        this.$message.error(e.message)\r\n      }\r\n    },\r\n    async addDelivery () {\r\n      try {\r\n        if (await deliveryService.addDelivery(this.deliveryForm)) {\r\n          this.$message.success('添加收货信息成功')\r\n          this.getDeliveryList()\r\n        }\r\n      } catch (e) {\r\n        this.$message.error(e.message)\r\n      }\r\n    },\r\n    handleSaveDelivery () {\r\n      this.$refs.deliveryForm.validate(v => {\r\n        if (v) {\r\n          this.addDelivery()\r\n        } else {\r\n          this.$message.error('请将信息填写完整')\r\n        }\r\n      })\r\n    },\r\n    async updateDelivery (delivery) {\r\n      delivery.defaultDelivery = true\r\n      try {\r\n        if (await deliveryService.updateDelivery(delivery)) {\r\n          this.$message.success('设为默认地址成功')\r\n          this.getDeliveryList()\r\n        }\r\n      } catch (e) {\r\n        this.$message.error(e.message)\r\n      }\r\n    },\r\n    async handleDelteDelivery (deliveryId) {\r\n      try {\r\n        if (await deliveryService.deleteDelivery(deliveryId)) {\r\n          this.$message.success('删除收货信息成功')\r\n          this.getDeliveryList()\r\n        }\r\n      } catch (e) {\r\n        this.$message.error(e.message)\r\n      }\r\n    },\r\n    async updateUserInfo () {\r\n      try {\r\n        if (await consumerService.updateUserInfo(this.userInfo)) {\r\n          this.$message.success('更新资料成功')\r\n        }\r\n      } catch (e) {\r\n        this.$message.error(e.message)\r\n      }\r\n    },\r\n    async handleUpdatePassword () {\r\n      if (this.oldPassword && this.newPassword && this.repeatPassword) {\r\n        if (this.newPassword !== this.repeatPassword) {\r\n          return this.$message.error('两次输入的新密码不一致')\r\n        }\r\n        try {\r\n          if (await consumerService.updatePassword(this.oldPassword, this.newPassword)) {\r\n            this.$message.success('修改密码成功')\r\n          }\r\n        } catch (e) {\r\n          this.$message.error(e.message)\r\n        }\r\n      } else {\r\n        this.$message.error('请将密码信息填写完整')\r\n      }\r\n    }\r\n  },\r\n  created () {\r\n    deliveryService.editPanel = this\r\n    this.getDeliveryList()\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n  .amap-box {\r\n    width: 100%;\r\n    height: 200px;\r\n  }\r\n  .delivery-list {\r\n    .el-icon-edit {\r\n      font-size: 20px;\r\n      height: 28px;\r\n      line-height: 28px;\r\n    }\r\n    h4 {\r\n      margin: 0;\r\n    }\r\n  }\r\n</style>\r\n"]}]}