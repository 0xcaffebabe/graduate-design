{"remainingRequest":"D:\\project\\blb-consumer-frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\project\\blb-consumer-frontend\\src\\components\\shop\\ShopEval.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\project\\blb-consumer-frontend\\src\\components\\shop\\ShopEval.vue","mtime":1613365578288},{"path":"D:\\project\\blb-consumer-frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\project\\blb-consumer-frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\project\\blb-consumer-frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\project\\blb-consumer-frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgc2hvcFNlcnZpY2UgZnJvbSAnLi4vLi4vc2VydmljZS9TaG9wU2VydmljZScNCmltcG9ydCBtb21lbnQgZnJvbSAnbW9tZW50Jw0KZXhwb3J0IGRlZmF1bHQgew0KICBwcm9wczogWydzaG9wSWQnXSwNCiAgZGF0YSAoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIHNob3BFdmFsOiB7fSwNCiAgICAgIGV2YWxMaXN0OiBbXSwNCiAgICAgIGN1cnJlbnRFdmFsOiAtMSwNCiAgICAgIGV2YWxQYWdlOiAxLA0KICAgICAgZXZhbFBhZ2VTaXplOiAxMCwNCiAgICAgIGV2YWxUb3RhbDogMA0KICAgIH0NCiAgfSwNCiAgY29tcHV0ZWQ6IHsNCiAgICBhbGxFdmFsU3VtICgpIHsNCiAgICAgIGlmICghdGhpcy5zaG9wRXZhbC53b3JkQ2xvdWQpIHsNCiAgICAgICAgcmV0dXJuIDANCiAgICAgIH0NCiAgICAgIGxldCBzdW0gPSAwDQogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuc2hvcEV2YWwud29yZENsb3VkLmxlbmd0aDsgaSsrKSB7DQogICAgICAgIHN1bSArPSB0aGlzLnNob3BFdmFsLndvcmRDbG91ZFtpXS5jb3VudA0KICAgICAgfQ0KICAgICAgcmV0dXJuIHN1bQ0KICAgIH0NCiAgfSwNCiAgbWV0aG9kczogew0KICAgIGFzeW5jIGdldFNob3BFdmFsICgpIHsNCiAgICAgIHRyeSB7DQogICAgICAgIGNvbnN0IHNob3BFdmFsID0gYXdhaXQgc2hvcFNlcnZpY2UuZ2V0U2hvcEV2YWwodGhpcy5zaG9wSWQpDQogICAgICAgIHRoaXMuc2hvcEV2YWwgPSBzaG9wRXZhbA0KICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKGUubWVzc2FnZSkNCiAgICAgIH0NCiAgICB9LA0KICAgIGFzeW5jIGdldFNob3BFdmFsTGlzdCAoKSB7DQogICAgICB0cnkgew0KICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgc2hvcFNlcnZpY2UuZ2V0U2hvcEV2YWxMaXN0KHsNCiAgICAgICAgICBzaG9wSWQ6IHRoaXMuc2hvcElkLA0KICAgICAgICAgIHRhZ0lkOiB0aGlzLmN1cnJlbnRFdmFsLA0KICAgICAgICAgIHBhZ2U6IHRoaXMuZXZhbFBhZ2UsDQogICAgICAgICAgc2l6ZTogdGhpcy5ldmFsUGFnZVNpemUNCiAgICAgICAgfSkNCiAgICAgICAgdGhpcy5ldmFsTGlzdCA9IGRhdGEuZGF0YQ0KICAgICAgICB0aGlzLmV2YWxUb3RhbCA9IGRhdGEudG90YWwNCiAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcihlLm1lc3NhZ2UpDQogICAgICB9DQogICAgfSwNCiAgICBjYWxjRGF0ZSAoZGF0ZSkgew0KICAgICAgcmV0dXJuIG1vbWVudChkYXRlLCAnWVlZWU1NREQnKS5mcm9tTm93KCkNCiAgICB9LA0KICAgIGhhbmRsZVBhZ2VDaGFuZ2VkICh2YWwpIHsNCiAgICAgIHRoaXMuZXZhbFBhZ2UgPSB2YWwNCiAgICAgIHRoaXMuZ2V0U2hvcEV2YWxMaXN0KCkNCiAgICB9LA0KICAgIGhhbmRsZVNpemVDaGFuZ2VkICh2YWwpIHsNCiAgICAgIHRoaXMuZXZhbFBhZ2VTaXplID0gdmFsDQogICAgICB0aGlzLmdldFNob3BFdmFsTGlzdCgpDQogICAgfSwNCiAgICBoYW5kbGVUYWdDbGljayAodGFnSWQpIHsNCiAgICAgIHRoaXMuY3VycmVudEV2YWwgPSB0YWdJZA0KICAgICAgdGhpcy5nZXRTaG9wRXZhbExpc3QoKQ0KICAgIH0NCiAgfSwNCiAgY3JlYXRlZCAoKSB7DQogICAgdGhpcy5nZXRTaG9wRXZhbCgpDQogICAgdGhpcy5nZXRTaG9wRXZhbExpc3QoKQ0KICB9DQp9DQo="},{"version":3,"sources":["ShopEval.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ShopEval.vue","sourceRoot":"src/components/shop","sourcesContent":["<template>\r\n  <el-row :gutter='20'>\r\n    <el-col :span='18'>\r\n        <el-tag class=\"eval-tag\" type='primary' :effect='currentEval == -1 ?\"dark\":\"light\"' @click=\"handleTagClick(-1)\">全部评价({{allEvalSum}})</el-tag>\r\n        <el-tag class=\"eval-tag\"\r\n        v-for='item in shopEval.wordCloud'\r\n        :key='item.id'\r\n        :type=\"!item.positive?'info':'primary'\"\r\n        :effect=\"currentEval === item.id?'dark':'light'\"\r\n        @click=\"handleTagClick(item.id)\"\r\n        >{{item.content}}({{item.count}})</el-tag>\r\n        <el-divider></el-divider>\r\n        <ul class=\"eval-list\">\r\n          <li v-for=\"item in evalList\" :key=\"item.evalId\" class=\"eval-list-item\">\r\n            <el-row>\r\n              <el-col :span=\"2\">\r\n                <el-avatar>{{item.nickName}}</el-avatar>\r\n              </el-col>\r\n              <el-col :span=\"22\">\r\n                <span class=\"eval-date\">{{calcDate(item.createTime)}}</span>\r\n                <h3>{{item.phone}}</h3>\r\n                <el-rate :value=\"parseFloat(item.ranking)\" disabled></el-rate>\r\n                <p>{{item.content}}</p>\r\n                <ul class=\"img-list\">\r\n                  <li v-for=\"img in item.imgList\" :key=\"img + Math.random()\">\r\n                    <el-image\r\n                    :src=\"img\"\r\n                    :preview-src-list=\"item.imgList\"\r\n                    fit=\"cover\"\r\n                    />\r\n                  </li>\r\n                </ul>\r\n              </el-col>\r\n            </el-row>\r\n            <el-divider></el-divider>\r\n          </li>\r\n        </ul>\r\n        <el-pagination\r\n          style=\"text-align:center\"\r\n          @size-change=\"handleSizeChanged\"\r\n          background\r\n          @current-change=\"handlePageChanged\"\r\n          :current-page=\"evalPage\"\r\n          :page-sizes=\"[2, 10, 20, 30]\"\r\n          :page-size=\"evalPageSize\"\r\n          layout=\"prev, pager, next\"\r\n          :total=\"evalTotal\">\r\n        </el-pagination>\r\n    </el-col>\r\n    <el-col :span='6'>\r\n      <el-card class='eval-info'>\r\n        <h2>{{shopEval.rating}}</h2>\r\n        <p class='eval-avg'>综合评价</p>\r\n        <p class='rating'>高于周围{{shopEval.wingRate}}%的商家</p>\r\n      </el-card>\r\n    </el-col>\r\n  </el-row>\r\n</template>\r\n\r\n<script>\r\nimport shopService from '../../service/ShopService'\r\nimport moment from 'moment'\r\nexport default {\r\n  props: ['shopId'],\r\n  data () {\r\n    return {\r\n      shopEval: {},\r\n      evalList: [],\r\n      currentEval: -1,\r\n      evalPage: 1,\r\n      evalPageSize: 10,\r\n      evalTotal: 0\r\n    }\r\n  },\r\n  computed: {\r\n    allEvalSum () {\r\n      if (!this.shopEval.wordCloud) {\r\n        return 0\r\n      }\r\n      let sum = 0\r\n      for (let i = 0; i < this.shopEval.wordCloud.length; i++) {\r\n        sum += this.shopEval.wordCloud[i].count\r\n      }\r\n      return sum\r\n    }\r\n  },\r\n  methods: {\r\n    async getShopEval () {\r\n      try {\r\n        const shopEval = await shopService.getShopEval(this.shopId)\r\n        this.shopEval = shopEval\r\n      } catch (e) {\r\n        this.$message.error(e.message)\r\n      }\r\n    },\r\n    async getShopEvalList () {\r\n      try {\r\n        const data = await shopService.getShopEvalList({\r\n          shopId: this.shopId,\r\n          tagId: this.currentEval,\r\n          page: this.evalPage,\r\n          size: this.evalPageSize\r\n        })\r\n        this.evalList = data.data\r\n        this.evalTotal = data.total\r\n      } catch (e) {\r\n        this.$message.error(e.message)\r\n      }\r\n    },\r\n    calcDate (date) {\r\n      return moment(date, 'YYYYMMDD').fromNow()\r\n    },\r\n    handlePageChanged (val) {\r\n      this.evalPage = val\r\n      this.getShopEvalList()\r\n    },\r\n    handleSizeChanged (val) {\r\n      this.evalPageSize = val\r\n      this.getShopEvalList()\r\n    },\r\n    handleTagClick (tagId) {\r\n      this.currentEval = tagId\r\n      this.getShopEvalList()\r\n    }\r\n  },\r\n  created () {\r\n    this.getShopEval()\r\n    this.getShopEvalList()\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang='less' scoped>\r\n.eval-info {\r\n  h2 {\r\n    margin: 0;\r\n    text-align: center;\r\n    color: #f60;\r\n  }\r\n  .eval-avg {\r\n    margin: 0;\r\n    text-align: center;\r\n    font-size: 16px;\r\n  }\r\n  .rating {\r\n    font-size: 14px;\r\n    color: #666;\r\n    text-align: center;\r\n  }\r\n}\r\n.eval-tag {\r\n  margin-right: 10px;\r\n  margin-bottom: 10px;\r\n  cursor: pointer;\r\n  transition: all 0.2s;\r\n}\r\n.eval-list-item {\r\n  h3 {\r\n    margin: 0;\r\n    font-size: 14px;\r\n  }\r\n  .el-rate {\r\n    margin: 5px 0;\r\n  }\r\n  p {\r\n    margin: 0;\r\n    font-size: 14px;\r\n  }\r\n  .eval-date {\r\n    float: right;\r\n    font-size: 12px;\r\n    color: #666;\r\n  }\r\n}\r\n.img-list {\r\n  li {\r\n    display: inline-block;\r\n    overflow: hidden;\r\n    padding: 10px 10px;\r\n    .el-image {\r\n      box-shadow: 2px 2px 6px #bbb;\r\n      height: 88px;\r\n      width: 88px;\r\n      img {\r\n        border-radius: 5px;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n"]}]}