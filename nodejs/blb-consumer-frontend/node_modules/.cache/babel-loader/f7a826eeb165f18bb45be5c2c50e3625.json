{"remainingRequest":"D:\\project\\blb-consumer-frontend\\node_modules\\thread-loader\\dist\\cjs.js!D:\\project\\blb-consumer-frontend\\node_modules\\babel-loader\\lib\\index.js!D:\\project\\blb-consumer-frontend\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\project\\blb-consumer-frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\project\\blb-consumer-frontend\\src\\views\\Pay.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\project\\blb-consumer-frontend\\src\\views\\Pay.vue","mtime":1606571741850},{"path":"D:\\project\\blb-consumer-frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\project\\blb-consumer-frontend\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\project\\blb-consumer-frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\project\\blb-consumer-frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\project\\blb-consumer-frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJyZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUiOwppbXBvcnQgX2FzeW5jVG9HZW5lcmF0b3IgZnJvbSAiRDovcHJvamVjdC9ibGItY29uc3VtZXItZnJvbnRlbmQvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2FzeW5jVG9HZW5lcmF0b3IiOwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwppbXBvcnQgcGF5U2VydmljZSBmcm9tICcuLi9zZXJ2aWNlL1BheVNlcnZpY2UnOwpleHBvcnQgZGVmYXVsdCB7CiAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIG9yZGVySWQ6IHRoaXMuJHJvdXRlLnBhcmFtcy5vcmRlcklkLAogICAgICBwYXlJZDogJycsCiAgICAgIHFyY29kZTogJycsCiAgICAgIHNob3BOYW1lOiAnJywKICAgICAgdGltZXI6IG51bGwsCiAgICAgIHBheVN0YXR1czogJycsCiAgICAgIHNob3BJbmZvOiB0aGlzLiRyb3V0ZS5wYXJhbXMuc2hvcEluZm8KICAgIH07CiAgfSwKICBtZXRob2RzOiB7CiAgICBnZXRQYXlJZDogZnVuY3Rpb24gZ2V0UGF5SWQoKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMigpIHsKICAgICAgICB2YXIgZGF0YTsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgX2NvbnRleHQyLnByZXYgPSAwOwogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAzOwogICAgICAgICAgICAgICAgcmV0dXJuIHBheVNlcnZpY2UuZ2VuZXJhdGVQYXkoX3RoaXMub3JkZXJJZCk7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIF90aGlzLnBheUlkID0gX2NvbnRleHQyLnNlbnQ7CgogICAgICAgICAgICAgICAgaWYgKCFfdGhpcy5wYXlJZCkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDEyOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDc7CiAgICAgICAgICAgICAgICByZXR1cm4gcGF5U2VydmljZS5nZXRQYXlJbmZvKF90aGlzLnBheUlkKTsKCiAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgZGF0YSA9IF9jb250ZXh0Mi5zZW50OwogICAgICAgICAgICAgICAgX3RoaXMucXJjb2RlID0gZGF0YS51cmw7CiAgICAgICAgICAgICAgICBfdGhpcy5zaG9wTmFtZSA9IGRhdGEuc2hvcE5hbWU7CiAgICAgICAgICAgICAgICBfdGhpcy5vcmRlcklkID0gZGF0YS5vcmRlcklkOwoKICAgICAgICAgICAgICAgIGlmIChfdGhpcy5xcmNvZGUpIHsKICAgICAgICAgICAgICAgICAgX3RoaXMudGltZXIgPSBzZXRJbnRlcnZhbCggLyojX19QVVJFX18qL19hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgc3RhdHVzOwogICAgICAgICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBheVNlcnZpY2UuZ2V0UGF5U3RhdHVzKF90aGlzLnBheUlkKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnBheVN0YXR1cyA9IHN0YXR1cy5tc2c7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXR1cy5zdGF0dXMgPT09IDIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g5pSv5LuY5oiQ5YqfCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoX3RoaXMudGltZXIpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuJG1lc3NhZ2Uuc3VjY2VzcyhzdGF0dXMubXNnKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLiRyb3V0ZXIucHVzaCgnL29yZGVyJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sIF9jYWxsZWUpOwogICAgICAgICAgICAgICAgICB9KSksIDMwMDApOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxNzsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDE0OgogICAgICAgICAgICAgICAgX2NvbnRleHQyLnByZXYgPSAxNDsKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi50MCA9IF9jb250ZXh0MlsiY2F0Y2giXSgwKTsKCiAgICAgICAgICAgICAgICBfdGhpcy4kbWVzc2FnZS5lcnJvcihfY29udGV4dDIudDAubWVzc2FnZSk7CgogICAgICAgICAgICAgIGNhc2UgMTc6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTIsIG51bGwsIFtbMCwgMTRdXSk7CiAgICAgIH0pKSgpOwogICAgfQogIH0sCiAgY3JlYXRlZDogZnVuY3Rpb24gY3JlYXRlZCgpIHsKICAgIHRoaXMuZ2V0UGF5SWQoKTsKICB9LAogIC8vIOWNs+Wwhuemu+W8gOivpemhtemdogogIGJlZm9yZVJvdXRlTGVhdmU6IGZ1bmN0aW9uIGJlZm9yZVJvdXRlTGVhdmUodG8sIGZyb20sIG5leHQpIHsKICAgIC8vIOemu+W8gOivpemhtemdouS5i+WJje+8jOa4heepuuWumuaXtuafpeivouaUr+S7mOeKtuaAgQogICAgY2xlYXJJbnRlcnZhbCh0aGlzLnRpbWVyKTsKICAgIG5leHQoKTsKICB9Cn07"},{"version":3,"sources":["Pay.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAgBA,OAAA,UAAA,MAAA,uBAAA;AACA,eAAA;AACA,EAAA,IADA,kBACA;AACA,WAAA;AACA,MAAA,OAAA,EAAA,KAAA,MAAA,CAAA,MAAA,CAAA,OADA;AAEA,MAAA,KAAA,EAAA,EAFA;AAGA,MAAA,MAAA,EAAA,EAHA;AAIA,MAAA,QAAA,EAAA,EAJA;AAKA,MAAA,KAAA,EAAA,IALA;AAMA,MAAA,SAAA,EAAA,EANA;AAOA,MAAA,QAAA,EAAA,KAAA,MAAA,CAAA,MAAA,CAAA;AAPA,KAAA;AASA,GAXA;AAYA,EAAA,OAAA,EAAA;AACA,IAAA,QADA,sBACA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBAEA,UAAA,CAAA,WAAA,CAAA,KAAA,CAAA,OAAA,CAFA;;AAAA;AAEA,gBAAA,KAAA,CAAA,KAFA;;AAAA,qBAGA,KAAA,CAAA,KAHA;AAAA;AAAA;AAAA;;AAAA;AAAA,uBAIA,UAAA,CAAA,UAAA,CAAA,KAAA,CAAA,KAAA,CAJA;;AAAA;AAIA,gBAAA,IAJA;AAKA,gBAAA,KAAA,CAAA,MAAA,GAAA,IAAA,CAAA,GAAA;AACA,gBAAA,KAAA,CAAA,QAAA,GAAA,IAAA,CAAA,QAAA;AACA,gBAAA,KAAA,CAAA,OAAA,GAAA,IAAA,CAAA,OAAA;;AACA,oBAAA,KAAA,CAAA,MAAA,EAAA;AACA,kBAAA,KAAA,CAAA,KAAA,GAAA,WAAA,uEAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mCACA,UAAA,CAAA,YAAA,CAAA,KAAA,CAAA,KAAA,CADA;;AAAA;AACA,4BAAA,MADA;AAEA,4BAAA,KAAA,CAAA,SAAA,GAAA,MAAA,CAAA,GAAA;;AACA,gCAAA,MAAA,CAAA,MAAA,KAAA,CAAA,EAAA;AACA;AACA,8BAAA,aAAA,CAAA,KAAA,CAAA,KAAA,CAAA;;AACA,8BAAA,KAAA,CAAA,QAAA,CAAA,OAAA,CAAA,MAAA,CAAA,GAAA;;AACA,8BAAA,KAAA,CAAA,OAAA,CAAA,IAAA,CAAA,QAAA;AACA;;AARA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAAA,IASA,IATA,CAAA;AAUA;;AAnBA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAsBA,gBAAA,KAAA,CAAA,QAAA,CAAA,KAAA,CAAA,aAAA,OAAA;;AAtBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAwBA;AAzBA,GAZA;AAuCA,EAAA,OAvCA,qBAuCA;AACA,SAAA,QAAA;AACA,GAzCA;AA0CA;AACA,EAAA,gBA3CA,4BA2CA,EA3CA,EA2CA,IA3CA,EA2CA,IA3CA,EA2CA;AACA;AACA,IAAA,aAAA,CAAA,KAAA,KAAA,CAAA;AACA,IAAA,IAAA;AACA;AA/CA,CAAA","sourcesContent":["<template>\r\n  <div>\r\n    <el-card>\r\n      <div slot=\"header\">\r\n        订单:{{shopName}} - {{orderId}}\r\n      </div>\r\n      <div style=\"text-align:center\">\r\n        <el-image :src=\"qrcode\" style=\"width:256px;height:256px\"></el-image>\r\n        <p>支付状态:{{payStatus}}</p>\r\n        <el-button type=\"primary\" @click=\"$router.push('order')\">已完成支付?</el-button>\r\n      </div>\r\n    </el-card>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport payService from '../service/PayService'\r\nexport default {\r\n  data () {\r\n    return {\r\n      orderId: this.$route.params.orderId,\r\n      payId: '',\r\n      qrcode: '',\r\n      shopName: '',\r\n      timer: null,\r\n      payStatus: '',\r\n      shopInfo: this.$route.params.shopInfo\r\n    }\r\n  },\r\n  methods: {\r\n    async getPayId () {\r\n      try {\r\n        this.payId = await payService.generatePay(this.orderId)\r\n        if (this.payId) {\r\n          const data = await payService.getPayInfo(this.payId)\r\n          this.qrcode = data.url\r\n          this.shopName = data.shopName\r\n          this.orderId = data.orderId\r\n          if (this.qrcode) {\r\n            this.timer = setInterval(async () => {\r\n              const status = await payService.getPayStatus(this.payId)\r\n              this.payStatus = status.msg\r\n              if (status.status === 2) {\r\n                // 支付成功\r\n                clearInterval(this.timer)\r\n                this.$message.success(status.msg)\r\n                this.$router.push('/order')\r\n              }\r\n            }, 3000)\r\n          }\r\n        }\r\n      } catch (e) {\r\n        this.$message.error(e.message)\r\n      }\r\n    }\r\n  },\r\n  created () {\r\n    this.getPayId()\r\n  },\r\n  // 即将离开该页面\r\n  beforeRouteLeave (to, from, next) {\r\n    // 离开该页面之前，清空定时查询支付状态\r\n    clearInterval(this.timer)\r\n    next()\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoed>\r\n\r\n</style>\r\n"],"sourceRoot":"src/views"}]}